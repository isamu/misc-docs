# Roo Code ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Roo Codeã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¯ã€LLMã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™å†…ã§é•·æ™‚é–“ã®ä¼šè©±ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®é«˜åº¦ãªæ©Ÿèƒ½ã§ã€AIè¦ç´„ã«ã‚ˆã‚‹çŸ¥çš„ãªåœ§ç¸®ã¨ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®äºŒæ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ

### ğŸ“˜ [01-overview.md](./01-overview.md)
**å¯¾è±¡èª­è€…**: ã™ã¹ã¦ã®é–‹ç™ºè€…

**å†…å®¹**:
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã®èª²é¡Œã¨è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- äºŒæ®µéšç®¡ç†ï¼ˆCondensation + Truncationï¼‰ã®èª¬æ˜
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 
- ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
- éç ´å£Šçš„ç®¡ç†ã®ä»•çµ„ã¿

**æ¨å¥¨**: ã¾ãšã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰èª­ã¿å§‹ã‚ã¦ãã ã•ã„

---

### ğŸ“— [02-implementation.md](./02-implementation.md)
**å¯¾è±¡èª­è€…**: å®Ÿè£…ã®è©³ç´°ã‚’ç†è§£ã—ãŸã„é–‹ç™ºè€…

**å†…å®¹**:
- `manageContext()` é–¢æ•°ã®è©³ç´°ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼
- Condensationï¼ˆå‡ç¸®ï¼‰ã®å®Ÿè£…
  - `summarizeConversation()` ã®è©³ç´°
  - tool_use/tool_resultãƒšã‚¢ã®ä¿æŒ
  - ã‚µãƒãƒªãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹é€ 
- Truncationï¼ˆãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®å®Ÿè£…
  - ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  - å¶æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ã®ç†ç”±
- MessageManagerã®å®Ÿè£…
  - å·»ãæˆ»ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼
  - ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³å¯¾ç­–
- ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…
- å®Ÿè£…ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**æ¨å¥¨**: åŒæ§˜ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„

---

### ğŸ“™ [03-api-reference.md](./03-api-reference.md)
**å¯¾è±¡èª­è€…**: APIã‚’ä½¿ç”¨ã™ã‚‹é–‹ç™ºè€…

**å†…å®¹**:
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚³ã‚¢API
  - `manageContext()`
  - `willManageContext()`
  - `truncateConversation()`
  - `estimateTokenCount()`
- å‡ç¸®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«API
  - `summarizeConversation()`
  - `getEffectiveApiHistory()`
  - `cleanupAfterTruncation()`
  - `getKeepMessagesWithToolBlocks()`
- MessageManagerAPI
  - `rewindToTimestamp()`
  - `rewindToIndex()`
- å‹å®šç¾©
  - `ApiMessage`
  - `ContextManagementOptions`
  - `ContextManagementResult`
  - ãã®ä»–ã™ã¹ã¦ã®å‹
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

**æ¨å¥¨**: é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹éš›ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„

---

### ğŸ“• [04-advanced-topics.md](./04-advanced-topics.md)
**å¯¾è±¡èª­è€…**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’æ·±ãç†è§£ã—ãŸã„é–‹ç™ºè€…

**å†…å®¹**:
- ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã®çµ±åˆ
  - Shadow Gitãƒªãƒã‚¸ãƒˆãƒª
  - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¿å­˜/å¾©å…ƒ
- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹
  - å‡ç¸®/ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµæœè¡¨ç¤º
  - è¨­å®šUI
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥è¨­å®š
  - è¨­å®šã®éšå±¤æ§‹é€ 
  - æ¨å¥¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
- ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
  - ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚¤ãƒ™ãƒ³ãƒˆ
  - ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°æŒ‡æ¨™
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
  - ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†
  - ä¸¦åˆ—å‡¦ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤
  - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¶…éã‚¨ãƒ©ãƒ¼
  - å‡ç¸®å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
  - ãƒ‡ãƒãƒƒã‚°æŠ€æ³•

**æ¨å¥¨**: å®Ÿè£…å¾Œã®æœ€é©åŒ–ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ä½¿ç”¨ã—ã¦ãã ã•ã„

---

### ğŸ““ [05-task-execution-flow.md](./05-task-execution-flow.md)
**å¯¾è±¡èª­è€…**: Roo Codeã®å…¨ä½“å‹•ä½œã‚’ç†è§£ã—ãŸã„é–‹ç™ºè€…

**å†…å®¹**:
- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®å…¨ä½“ãƒ•ãƒ­ãƒ¼
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰ã‚¿ã‚¹ã‚¯å®Œäº†ã¾ã§
  - ãƒ¡ã‚¤ãƒ³ã®å®Ÿè¡Œãƒ«ãƒ¼ãƒ—ï¼ˆinitiateTaskLoopï¼‰
  - LLMã¨ã®å¯¾è©±ãƒ«ãƒ¼ãƒ—
  - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†
  - ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œãƒ•ãƒ­ãƒ¼
- ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
  - 5ã¤ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆArchitect, Code, Ask, Debug, Orchestratorï¼‰
  - ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã¨åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«
  - switch_modeã«ã‚ˆã‚‹åˆ‡ã‚Šæ›¿ãˆ
  - new_taskã«ã‚ˆã‚‹ã‚µãƒ–ã‚¿ã‚¹ã‚¯å§”è­²
  - ã‚µãƒ–ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã®è¦ªå¾©å¸°
- TODO Listç®¡ç†
  - update_todo_listãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹
  - TODOãƒªã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒ«
- Context Managementã¨ã®çµ±åˆ
  - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ•ãƒ­ãƒ¼å†…ã§ã®Context Managementå‘¼ã³å‡ºã—
  - ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†
  - ã‚µãƒ–ã‚¿ã‚¹ã‚¯å§”è­²æ™‚ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†é›¢
- å…¸å‹çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹
- ãƒ‡ãƒãƒƒã‚°ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

**æ¨å¥¨**: Roo CodeãŒã©ã®ã‚ˆã†ã«ã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã™ã‚‹ã‹ã®å…¨ä½“åƒã‚’ç†è§£ã™ã‚‹éš›ã«èª­ã‚“ã§ãã ã•ã„

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```typescript
import { manageContext } from './core/context-management'
import { getEffectiveApiHistory } from './core/condense'

// 1. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚’å®Ÿè¡Œ
const result = await manageContext({
  messages: apiConversationHistory,
  totalTokens: currentTokenCount,
  contextWindow: 200000,
  maxTokens: 4096,
  apiHandler: api,
  autoCondenseContext: true,
  autoCondenseContextPercent: 75,
  systemPrompt: SYSTEM_PROMPT,
  taskId: "task-123",
  profileThresholds: {},
  currentProfileId: "default",
  useNativeTools: true
})

// 2. æ›´æ–°ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
apiConversationHistory = result.messages

// 3. APIé€ä¿¡ç”¨ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
const effectiveHistory = getEffectiveApiHistory(apiConversationHistory)

// 4. APIãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
const response = await api.createMessage(systemPrompt, effectiveHistory)
```

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤/ç·¨é›†

```typescript
import { MessageManager } from './core/message-manager'

// MessageManagerã‚’ä½¿ç”¨ï¼ˆç›´æ¥å‰Šé™¤ã—ãªã„ï¼ï¼‰
await task.messageManager.rewindToTimestamp(messageTs, {
  includeTargetMessage: operation === "delete"  // delete=true, edit=false
})
```

---

## ä¸»è¦æ¦‚å¿µ

### éç ´å£Šçš„ç®¡ç†

Roo Codeã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç‰©ç†çš„ã«å‰Šé™¤ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ï¼š

1. **ã‚¿ã‚°ä»˜ã‘**: `condenseParent`ã‚„`truncationParent`ã‚¿ã‚°ã§ãƒãƒ¼ã‚¯
2. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: `getEffectiveApiHistory()`ã§APIé€ä¿¡æ™‚ã«é™¤å¤–
3. **å¾©å…ƒ**: å·»ãæˆ»ã—æ™‚ã«è‡ªå‹•çš„ã«å¾©å…ƒ

ã“ã‚Œã«ã‚ˆã‚Šï¼š
- âœ… ãƒ‡ãƒ¼ã‚¿æå¤±ãªã—
- âœ… ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã¨ã®äº’æ›æ€§
- âœ… ã„ã¤ã§ã‚‚éå»ã®çŠ¶æ…‹ã«æˆ»ã›ã‚‹

### äºŒæ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã—ãã„å€¤è¶…é?                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ Yes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1æ®µéš: Condensation (AIè¦ç´„)          â”‚
â”‚ - LLMã§ä¼šè©±ã‚’è¦ç´„                       â”‚
â”‚ - 70-90%ã®ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›                  â”‚
â”‚ - ã‚³ã‚¹ãƒˆç™ºç”Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ å¤±æ•— or ç„¡åŠ¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2æ®µéš: Truncation (ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°)    â”‚
â”‚ - å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™                   â”‚
â”‚ - ç¢ºå®Ÿãªå‰Šæ¸›                            â”‚
â”‚ - ã‚³ã‚¹ãƒˆãªã—                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: TypeScript
- **ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒˆ**: Tiktoken (`o200k_base`)
- **LLM API**: Anthropic SDK, OpenAI SDK
- **UI**: React + VSCode Webview UI Toolkit
- **æ°¸ç¶šåŒ–**: JSON ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**: Shadow Git ãƒªãƒã‚¸ãƒˆãƒª

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Layer (React)                      â”‚
â”‚  - ContextWindowProgress                                 â”‚
â”‚  - CondensationResultRow                                 â”‚
â”‚  - TruncationResultRow                                   â”‚
â”‚  - ContextManagementSettings                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• Events
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Task Layer                            â”‚
â”‚  - Task.ts (ãƒ¡ã‚¤ãƒ³åˆ¶å¾¡)                                  â”‚
â”‚  - MessageManager (å·»ãæˆ»ã—ç®¡ç†)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• API Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Context Management Layer                    â”‚
â”‚  - manageContext() (åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼)                          â”‚
â”‚  - willManageContext() (äº‹å‰ãƒã‚§ãƒƒã‚¯)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†•                                 â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Condensation       â”‚      â”‚    Truncation        â”‚
â”‚  - summarize         â”‚      â”‚  - truncate          â”‚
â”‚  - getKeepMessages   â”‚      â”‚  - tag messages      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Persistence Layer                        â”‚
â”‚  - readApiMessages() / saveApiMessages()                 â”‚
â”‚  - JSON file storage                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

### ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- [`src/core/context-management/index.ts`](../../src/core/context-management/index.ts) - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚³ã‚¢
- [`src/core/condense/index.ts`](../../src/core/condense/index.ts) - å‡ç¸®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- [`src/core/message-manager/index.ts`](../../src/core/message-manager/index.ts) - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
- [`src/core/task-persistence/apiMessages.ts`](../../src/core/task-persistence/apiMessages.ts) - æ°¸ç¶šåŒ–

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [`src/utils/tiktoken.ts`](../../src/utils/tiktoken.ts) - ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒ†ã‚£ãƒ³ã‚°
- [`src/core/context/context-management/context-error-handling.ts`](../../src/core/context/context-management/context-error-handling.ts) - ã‚¨ãƒ©ãƒ¼æ¤œå‡º

### UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [`webview-ui/src/components/chat/ContextWindowProgress.tsx`](../../webview-ui/src/components/chat/ContextWindowProgress.tsx)
- [`webview-ui/src/components/chat/context-management/`](../../webview-ui/src/components/chat/context-management/)
- [`webview-ui/src/components/settings/ContextManagementSettings.tsx`](../../webview-ui/src/components/settings/ContextManagementSettings.tsx)

### ãƒ†ã‚¹ãƒˆ
- [`src/core/context-management/__tests__/`](../../src/core/context-management/__tests__/)
- [`src/core/condense/__tests__/`](../../src/core/condense/__tests__/)
- [`src/core/message-manager/index.spec.ts`](../../src/core/message-manager/index.spec.ts)

---

## é‡è¦ãªå®šæ•°

```typescript
// ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
TOKEN_BUFFER_PERCENTAGE = 0.1          // 10%ãƒãƒƒãƒ•ã‚¡äºˆç´„

// å‡ç¸®
N_MESSAGES_TO_KEEP = 3                 // ä¿æŒã™ã‚‹æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°
MIN_CONDENSE_THRESHOLD = 5             // æœ€å°ã—ãã„å€¤ 5%
MAX_CONDENSE_THRESHOLD = 100           // æœ€å¤§ã—ãã„å€¤ 100%

// ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒˆ
TOKEN_FUDGE_FACTOR = 1.5               // èª¤å·®èª¿æ•´ä¿‚æ•°

// ãƒªãƒˆãƒ©ã‚¤
MAX_CONTEXT_WINDOW_RETRIES = 3         // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°
FORCED_CONTEXT_REDUCTION_PERCENT = 75  // å¼·åˆ¶å‰Šæ¸›æ™‚ã®ä¿æŒç‡
```

---

## æ¨å¥¨å­¦ç¿’ãƒ‘ã‚¹

### åˆå­¦è€…å‘ã‘
1. [01-overview.md](./01-overview.md) - å…¨ä½“åƒã‚’ç†è§£
2. [05-task-execution-flow.md](./05-task-execution-flow.md) - Roo Codeã®å‹•ä½œãƒ•ãƒ­ãƒ¼ã‚’æŠŠæ¡
3. [03-api-reference.md](./03-api-reference.md) - ã‚ˆãä½¿ã†é–¢æ•°ã‚’ç¢ºèª
4. å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§è©¦ã™
5. [04-advanced-topics.md](./04-advanced-topics.md) - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‚ç…§

### å®Ÿè£…è€…å‘ã‘
1. [01-overview.md](./01-overview.md) - è¨­è¨ˆæ€æƒ³ã‚’ç†è§£
2. [05-task-execution-flow.md](./05-task-execution-flow.md) - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®å…¨ä½“åƒã‚’æŠŠæ¡
3. [02-implementation.md](./02-implementation.md) - è©³ç´°ãªå®Ÿè£…ã‚’å­¦ç¿’
4. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ï¼ˆãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰
5. [03-api-reference.md](./03-api-reference.md) - APIä»•æ§˜ç¢ºèª
6. [04-advanced-topics.md](./04-advanced-topics.md) - æœ€é©åŒ–ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆè€…å‘ã‘
1. [01-overview.md](./01-overview.md) - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“
2. [05-task-execution-flow.md](./05-task-execution-flow.md) - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¨ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã®ä»•çµ„ã¿
3. [04-advanced-topics.md](./04-advanced-topics.md) - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆçµ±åˆã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒª
4. [02-implementation.md](./02-implementation.md) - å®Ÿè£…ã®è©³ç´°
5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®åˆ†æ

---

## FAQ

### Q: ãªãœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ã›ãšã«ã‚¿ã‚°ä»˜ã‘ã™ã‚‹ã®ã‹ï¼Ÿ
**A**: éç ´å£Šçš„ç®¡ç†ã«ã‚ˆã‚Šã€ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã¨ã®äº’æ›æ€§ã‚’ä¿ã¡ã€ã„ã¤ã§ã‚‚éå»ã®çŠ¶æ…‹ã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿æå¤±ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### Q: Condensation ã¨ Truncation ã®é•ã„ã¯ï¼Ÿ
**A**:
- **Condensation**: LLMã‚’ä½¿ã£ãŸçŸ¥çš„ãªè¦ç´„ã€‚æƒ…å ±ã‚’ä¿æŒã—ã¤ã¤å¤§å¹…ã«åœ§ç¸®ã€‚ã‚³ã‚¹ãƒˆç™ºç”Ÿã€‚
- **Truncation**: å˜ç´”ãªã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€‚ç¢ºå®Ÿã ãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæå¤±ã€‚ã‚³ã‚¹ãƒˆãªã—ã€‚

### Q: ã—ãã„å€¤ã¯ã©ã®ã‚ˆã†ã«è¨­å®šã™ã¹ãã‹ï¼Ÿ
**A**:
- é«˜æ€§èƒ½/é«˜ã‚³ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆOpusï¼‰: 80%ï¼ˆæœ€å¤§é™æ´»ç”¨ï¼‰
- ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆSonnetï¼‰: 75%ï¼ˆæ¨å¥¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- ä½ã‚³ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆHaikuï¼‰: 60%ï¼ˆæ—©ã‚ã«å‡ç¸®ï¼‰

### Q: å‡ç¸®ãŒå¤±æ•—ã—ãŸå ´åˆã¯ï¼Ÿ
**A**: è‡ªå‹•çš„ã«Truncationã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ã¯`result.error`ã«æ ¼ç´ã•ã‚Œã€`result.truncationId`ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚

### Q: ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆå¾©å…ƒå¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ¶ˆãˆãŸï¼Ÿ
**A**: `MessageManager`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿç›´æ¥`filter()`ã§å‰Šé™¤ã™ã‚‹ã¨ã€å­¤ç«‹ã—ãŸã‚¿ã‚°ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚å¿…ãš`task.messageManager.rewindToTimestamp()`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

---

## è²¢çŒ®

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ”¹å–„ææ¡ˆã‚„ãƒã‚°å ±å‘Šã¯ã€GitHubã®Issuesã§ãŠé¡˜ã„ã—ã¾ã™ã€‚

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Roo Codeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ä½œæˆæ—¥

2025å¹´12æœˆ28æ—¥

## æœ€çµ‚æ›´æ–°

2025å¹´12æœˆ29æ—¥

---

**Happy Coding! ğŸš€**
